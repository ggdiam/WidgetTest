var namespaceWidget=function(){var t=this;t.minWidth=150,t.maxWidth=250,t.margin=20,t.ns="namespace",t.cols=null,t.rows=null,t.script=null,t.options=null,t.cont=null,t.contParent=null,t.data=null,t.init=function(){if(t.processScriptAndOptions(),t.appendStyles(),t.appendWidgetElement(),t.contParent=t.cont.parentNode,t.options&&(t.options.cols&&(t.cols=t.options.cols,t.cols>4&&(t.cosl=4)),t.options.rows&&(t.rows=t.options.rows)),!t.cols||!t.rows)return void console.error("namespaceWidget: Ошибка инициализации");if(t.getData(),t.data.length>0){var e=t.appendElement(t.cont,"div",t.ns+"-inner-widget-container"),n=t.cols*t.rows;n>t.data.length&&(n=t.data.length);for(var o=0;n>o;o++)t.createItem(e,o);t.watch(),t.cont.style.visibility="hidden",t.setContWidth(),setTimeout(function(){t.setContWidth(),t.cont.style.visibility=""},300),console.log("namespaceWidget создан,",t.cols,"колонок и",t.rows,"столбцов")}},t.getData=function(){t.data=["В канаде сошел с рельсов и загорелся поезд с ядовитыми веществами","Глава горздрава Москвы подал в отставку из-за вида на жительство в Швейцарии","«Известия»: депутаты предлагают призывать в армию раз в год","Житель Самары в ходе уборки в комнате квартиранта обнаружил 8 кг «спайса»","Россия: Украина сделала все, чтобы помешать расследованию катастрофы Boeing","«РГ»: Совфед собирается запретить «спайсы»"]},t.createItem=function(e,n){var o="col-xs-3";switch(t.cols){case 1:olClass="col-xs-12";break;case 2:olClass="col-xs-6";break;case 3:olClass="col-xs-4";break;case 4:olClass="col-xs-3"}var a=t.ns+"-item";a+=" "+t.ns+"-"+o;var i=t.appendElement(e,"div",a),s=(t.appendElement(i,"div",t.ns+"-item-img"),t.appendElement(i,"div",t.ns+"-item-text"));s.innerHTML=t.data[n]},t.setContWidth=function(){for(var e=t.contParent.offsetWidth-2*t.margin,n={},o=t.cols;o>=1;o--){var a=t.getNumColsMinWidth(o),i=t.getNumColsMaxWidth(o);if(e>=i||e>=a){n.width=t.getMaxColWidthFromParentWidth(e,o),n.cols=o;break}}var s=n.width*n.cols+t.margin*(o-1)+1,r=t.getNumColsMaxWidth(t.cols);s>r&&(s=r),t.cont.style.width=s+"px";for(var c=document.getElementsByClassName(t.ns+"-item-img"),l=document.getElementsByClassName(t.ns+"-item"),d=0,u=0;u<l.length;u++){var m=l[u];m.style.width=n.width+"px"}for(var u=0;u<c.length;u++){var p=c[u];p.style.height=n.width+"px";var m=l[u],g=m.offsetHeight;g>d&&(d=g),m.style.minHeight=d+"px"}},t.processScriptAndOptions=function(){t.script=document.currentScript||function(){var t=document.getElementsByTagName("script");return t[t.length-1]}(),t.script.hasAttribute("data-cols")&&t.script.hasAttribute("data-rows")&&(t.options={cols:t.script.getAttribute("data-cols"),rows:t.script.getAttribute("data-rows")})},t.appendStyles=function(){var e=t.script.getAttribute("src");e=e.replace(".js",".css");var n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,head=document.head||document.getElementsByTagName("head")[0],head.appendChild(n)},t.appendWidgetElement=function(){t.cont=document.createElement("div"),t.cont.className=t.ns+"-widget",t.script.parentNode.insertBefore(t.cont,t.script)},t.watch=function(){t.addEvent(window,"resize",function(){t.setContWidthDebounce()})},t.getNumColsMaxWidth=function(e){return t.maxWidth*e+t.margin*(e-1)},t.getNumColsMinWidth=function(e){return t.minWidth*e+t.margin*(e-1)},t.getMaxColWidthFromParentWidth=function(e,n){var o=e-t.margin*(n-1);return o=Math.floor(o/n),o>t.maxWidth&&(o=t.maxWidth),o},t.getCountedHeigth=function(t){var e,n;return document.all?(e=t.currentStyle.height,n=parseInt(t.currentStyle.marginTop,10)+parseInt(t.currentStyle.marginBottom,10)+"px"):(e=document.defaultView.getComputedStyle(t,"").getPropertyValue("height"),n=parseInt(document.defaultView.getComputedStyle(t,"").getPropertyValue("margin-top"))+parseInt(document.defaultView.getComputedStyle(t,"").getPropertyValue("margin-bottom"))+"px"),console.log("elmHeight:",e,"elmMargin:",n),parseInt((e+n).replace(".px",""),10)},t.appendElement=function(t,e,n){var o=document.createElement(e);return o.className=n,t.appendChild(o),o},t.debounce=function(t,e,n){var o;return function(){var a=this,i=arguments,s=function(){o=null,n||t.apply(a,i)},r=n&&!o;clearTimeout(o),o=setTimeout(s,e),r&&t.apply(a,i)}},t.setContWidthDebounce=t.debounce(function(){t.setContWidth()},50),t.addEvent=function(t,e,n){null!=t&&"undefined"!=typeof t&&(t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n)},t.init()};window.namespaceWidget=new namespaceWidget;